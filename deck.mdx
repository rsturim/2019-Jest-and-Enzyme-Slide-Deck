import { Head, Image, Appear } from 'mdx-deck';
import { Invert } from 'mdx-deck/layouts';
import { CodeSurfer } from 'mdx-deck-code-surfer';

import nightOwl from 'prism-react-renderer/themes/nightOwl';

export { default as theme } from './theme.js';

<Head>
    <title>Testing React Components with Jest and Enyzme</title>
</Head>

<center>

# Level Up 2019

# ðŸš€

</center>

---

<center>

## Testing React Components

### _using_

## _Jest and Enyzme_

# ðŸš€

</center>

---

# Rich Sturim

## Senior UI Developer

### Two Week Mitosis (Advertising)

---

## What we'll cover

### Jest

<ul>
    <Appear>
        <li>What the heck is it?</li>
        <li>Installation and setup</li>
        <li>Basic Features</li>
        <li>Snapshot testing</li>
    </Appear>

</ul>

### Enyzme

<ul>
    <Appear>
        <li>What the heck is it?</li>
        <li>Installation and setup</li>
        <li>Basic Features</li>
        <li>Snapshot testing</li>
        <li>Shallow Rendering</li>
        <li>Full DOM Rendering</li>
        <li>Simulating User Events</li>
        <li>Props and State</li>
        <li>React lifecycles</li>
        <li>Component instance methods</li>
    </Appear>

</ul>

---

<Image src="./images/jest.svg" size="600px" />

---

# Jest

## 24.7

### https://jestjs.io/

---

# Jest

## - Test runner

## - Assertion library (very much like Jasmine)

### (lots and lots more)

---

## Jest also works with ...

-   TypeScript
-   Node
-   Angular
-   Vue
-   and more

---

<CodeSurfer
    title="Jest Installation"
    theme={nightOwl}
    notes="Can be install with yarn or npm"
    code={require('!raw-loader!./snippets/2.jest-install.cmd')}
/>

---

<CodeSurfer
    title="typical package.json"
    lang="javascript"
    theme={nightOwl}
    notes="some notes"
    showNumbers={false}
    code={require('!raw-loader!./snippets/5-package.js')}
    steps={[
        { notes: '' },
        { lines: [33], notes: 'Jest is installed' },
        { range: [2, 11], notes: 'custom scripts' },
        { range: [5, 6], notes: 'test commands' },
        { lines: [5], notes: 'npm run test' },
        {
            lines: [6],
            notes: 'npm run test-watch',
        },
    ]}
/>

---

<CodeSurfer
    showNumbers={false}
    code={require('!raw-loader!./snippets/6.function.js')}
    title='simple "sum" function'
    theme={nightOwl}
    lang="javascript"
/>

---

<CodeSurfer
    title="Anatomy of a test"
    code={require('!raw-loader!./snippets/6b.expect.js')}
    lang="javascript"
    theme={nightOwl}
    notes="notes"
    showNumbers={false}
    steps={[
        { notes: '' },
        { lines: [1, 9], notes: 'test' },
        { range: [2, 4], notes: 'expectation' },
        { range: [5, 8], notes: 'outcome to verify' },
    ]}
/>

---

# Matchers

---

<CodeSurfer
    title="Truthiness"
    code={require('!raw-loader!./snippets/7a.truthyness-matchers.js')}
    lang="javascript"
    theme={nightOwl}
    notes="Truthiness, in tests you sometimes need to distinguish between undefined, null, and false"
    steps={[
        { lines: [1, 2, 8] },
        { range: [1, 8] },
        { lines: [10, 11, 17] },
        { range: [10, 17] },
    ]}
/>

---

<CodeSurfer
    title="Number matchers"
    code={require('!raw-loader!./snippets/7b.number-matchers.js')}
    lang="javascript"
    theme={nightOwl}
    notes="Most ways of comparing numbers have matcher equivalents"
    steps={[{ lines: [1, 2, 10] }, { range: [1, 10] }]}
/>

---

<CodeSurfer
    title="Arrays and iterables"
    code={require('!raw-loader!./snippets/7c.array-matchers.js')}
    lang="javascript"
    theme={nightOwl}
    notes="You can check if an array or iterable contains a particular item using 'toContain'"
    showNumbers={false}
    steps={[
        { range: [1, 7] },
        { range: [1, 12] },
        { tokens: { 10: [6, 7, 8, 9, 10] } },
    ]}
/>

---

<CodeSurfer
    title="String matchers"
    code={require('!raw-loader!./snippets/7d.string-matchers.js')}
    lang="javascript"
    theme={nightOwl}
    notes="You can check strings against regular expressions with 'toMatch'"
    showNumbers={false}
/>

---

<CodeSurfer
    title="Exception matchers"
    code={require('!raw-loader!./snippets/7e.exception-matchers.js')}
    lang="javascript"
    theme={nightOwl}
    notes="If you want to test that a particular function throws an error when it's called, use 'toThrow'"
    showNumbers={false}
    steps={[
        { range: [1, 3] },
        { range: [1, 12] },
        {
            tokens: {
                6: [5, 6, 7, 8, 9],
                7: [5, 6, 7, 8, 9, 10],
                10: [5, 6, 7, 8, 9, 10],
                11: [5, 6, 7, 8, 9, 10],
            },
            notes: 'exceptions',
        },
    ]}
/>

---

<CodeSurfer
    title="So many matchers"
    code={require('!raw-loader!./snippets/7f.all-jest-matchers.js')}
    theme={nightOwl}
    lang="javascript"
/>

---

<CodeSurfer
    title="The most common"
    code={require('!raw-loader!./snippets/7g.most-common-matchers.js')}
    theme={nightOwl}
    notes="these can go a loooooong way"
    lang="javascript"
/>

---

## Anatomy of several tests

---

<CodeSurfer
    title="Describe blocks"
    code={require('!raw-loader!./snippets/8.describe.js')}
    theme={nightOwl}
    lang="javascript"
    showNumbers={false}
    steps={[
        { notes: '' },
        { range: [1, 4] },
        { lines: [6, 14] },
        { range: [6, 14] },
    ]}
/>

---

## Setup and Teardown

### Each time

### _before and/or after EACH test runs_

---

<CodeSurfer
    title="beforeEach() and afterEach()"
    code={require('!raw-loader!./snippets/8a.each.js')}
    theme={nightOwl}
    lang="javascript"
    showNumbers={false}
    steps={[
        { notes: 'Repeating Setup For Many Tests' },
        { range: [1, 7] },
        { range: [1, 17] },
    ]}
/>

---

## Setup and Teardown

### One Time

### _before and/or after ALL tests run_

---

<CodeSurfer
    title="Setup and Teardown â€” all"
    code={require('!raw-loader!./snippets/8b.onetime.js')}
    theme={nightOwl}
    lang="javascript"
    showNumbers={false}
    steps={[{ notes: 'One-Time Setup' }, { range: [1, 9] }, { range: [1, 19] }]}
/>

---

<Image src="./images/airbnb.png" size="200px" />

---

# Enyzme

## 3.9.0

### https://airbnb.io/enzyme/

---

# What is Enzyme?

## Enzyme is a JavaScript library for testing your React Components.

```notes
started over 3 years ago
been over 52 versions
```

---

<CodeSurfer
    title="Enzyme Installation"
    theme={nightOwl}
    notes="Can be install with yarn or npm"
    code={require('!raw-loader!./snippets/3.enzyme-install.cmd')}
    showNumbers={false}
    steps={[
        { notes: 'use with reactjs will require this' },
        { lines: [1], notes: 'reference the enyzme polyfill' },
        { lines: [3], notes: 'test shim' },
    ]}
/>

---

<CodeSurfer
    title="Enzyme polyfill config"
    showNumbers={false}
    code={require('!raw-loader!./snippets/5-package.js')}
    theme={nightOwl}
    lang="javascript"
    notes="somewhere in your project"
    steps={[
        { notes: 'designate the setupFilesAfterEnv' },
        { lines: [23, 24] },
        { range: [50, 52], notes: 'Jest entry' },
        { lines: [51], notes: 'reference the enyzme polyfill' },
    ]}
/>

---

<CodeSurfer
    title="Enzyme Setup Polyfil"
    theme={nightOwl}
    notes="enzyme.setup.js"
    code={require('!raw-loader!./snippets/4.setup.js')}
/>

---

<CodeSurfer
    title="Enzyme Setup Polyfil"
    theme={nightOwl}
    notes="enzyme.setup.js"
    showNumbers={false}
    code={require('!raw-loader!./snippets/4b.setup.js')}
    steps={[{ range: [1, 17] }, { range: [5, 8] }]}
/>

---

## Two Rendering methods for components

---

# Shallow Rendering

```
import { shallow } from 'enzyme';

const wrapper = shallow(<PlanetList />);
```

---

# Full DOM Rendering

```
import { mount } from 'enzyme';

const wrapper = mount(<PlanetList />);
```

---

# Debugging

```
const wrapper = shallow(<PlanetList />);

console.log(wrapper.debug());
```

---

<CodeSurfer
    title="Debug Output for Shallow Rendering"
    code={require('!raw-loader!./snippets/9.debugging.js')}
    lang="javascript"
    showNumbers={false}
    theme={nightOwl}
    notes="Planets.test.js"
/>

---

Enzyme Selectors

## there are 4 categories of accepted enzyme selectors

---

<CodeSurfer
    title="1. CSS selectors"
    code={require('!raw-loader!./snippets/10.selector.js')}
    lang="javascript"
    showNumbers={false}
    theme={nightOwl}
    notes="notes"
    steps={[
        { lines: [1] },
        { range: [3, 4] },
        { range: [6, 7] },
        { range: [9, 10] },
        { range: [12, 13] },
        { range: [15, 16] },
        { range: [18, 19] },
    ]}
/>

---

<CodeSurfer
    title="2. Constructor selector"
    code={require('!raw-loader!./snippets/11.ctor.js')}
    lang="javascript"
    showNumbers={false}
    theme={nightOwl}
    steps={[{ range: [1, 3] }, { range: [1, 6] }]}
/>

---

<CodeSurfer
    title="3. Components display name"
    code={require('!raw-loader!./snippets/12.displayname.js')}
    lang="javascript"
    showNumbers={false}
    theme={nightOwl}
    steps={[{ range: [1, 5] }, { range: [1, 8] }]}
/>

---

<CodeSurfer
    title="4. Object property selector"
    code={require('!raw-loader!./snippets/13.object.js')}
    lang="javascript"
    theme={nightOwl}
/>

---

<CodeSurfer
    title="All together now â€” Jest + Enzyme"
    code={require('!raw-loader!./snippets/14.together.js')}
    lang="javascript"
    theme={nightOwl}
/>

---

<center>

# Enough!

## Please show us some real code

# ðŸ¤¦ ðŸ¤¦ ðŸ¤¦

 </center>

---

# demo-app project

## walkthough

### basic pages + snapshots

-   src/App.test.js
-   src/pages/tests/ComponentOne.test.js
-   src/pages/tests/Planets.test.js
-   src/pages/tests/Address.test.js

---

# demo-app project

### enzyme pages

-   src/components/tests/Form.test.js
-   src/components/tests/PlanetList.test.js

---

# What else?

<Appear>
    <li> jest --coverage</li>
    <li> jest --help</li>
    <li>husky</li>
</Appear>

---

<Invert>

# Questions?

</Invert>

---

# github.com/rsturim

## repo: _demo-app_

## slack: _richie_rich_

-   mdx-deck
-   code-surfer
